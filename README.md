# :mag: WordPress Security Audit Logs (WSAL) Uploader :mag_right:

> Fetch WordPress security audit logs generated by [WP Security Audit Log plugin] and ship it to AWS S3.
>
> The plugin is also known as "WordPress activity log plugin"
>

Are you using WPEngine? No-problem. This will still work. See the remote installation instructions below.

---

## How it works?

- Fetch the security audit logs from the WordPress site database ([WP Security Audit Log plugin]).
  *Note that only new data will be fetched. The tool tracks the logs offset using a local file saved in the tool's directory.*
- Structure the data
- Ship the structured data as JSON file to the AWS S3 bucket defined in the config.py file

### WordPress relevant data tables
  - wp_wsal_occurrences
  - wp_wsal_metadata 

---

## Installation
The tool can be installed on the webserver itself or on a remote server with read access to the site's database.

*For security reasons, it is recommended that when using remote access, it will be made with a dedicated
user with read-only access to the database.* 

- Install [WP Security Audit Log plugin] on the WordPress website
- Install the tool on the server
  - Recommended location `/opt/wsal-uploader`
  - Clone the repository - `git clone https://github.com/rotemreiss/wsal-uploader.git`
  - Copy `config.py.template` to `config.py`
      ```bash
      cp config.py.template config.py
      ```
  - Fill the configuration 
  - Install all dependencies with `pip install -r requirements.txt`
  - Run the tool manually to verify the installation:
      ```bash
      $ python wsal_uploader.py
    
      # You should see output like:
      [+] Updated the log file. Last ID is now: 14
      ```
### Run it hourly
You will probably want to create a cron job to run the tool hourly

```bash
$ crontab -e
0 * * * *     python /opt/wsal-uploader/wsal_uploader.py > /dev/null 2>&1
```

### WPEngine remote installation
In order to access a WordPress database on WPEngine, you should follow the instructions at https://wpengine.com/support/setting-remote-database-access.

## Logs structure on S3
The logs will be saved in the S3 bucket in the following path:
```
s3://[WEBSITE-DOMAIN]/[HOSTNAME]--wp-audit-logs-[CONFIG_FILE_NAME]-[LAST-LOG-ID].json

# Example
s3://mywordpress.com/server-aws--wp-audit-logs-config-14.json
```

## Advanced Usage
- The tool also supports multiple configuration files (for multiple sites) 
```bash
# Clone the configuration file to config2.py (the name is up to you..) and use the -c flag
python wsal_uploader.py -c config2
```

---

## Recommended Python Version
The tool was developed and tested only with __Python3.6__.


<!-- Markdown helper -->
[WP Security Audit Log plugin]: https://www.wpsecurityauditlog.com/

---
## Contributing
Feel free to fork the repository and submit pull-requests.

---

## Support

Want to say thanks? :) Message me on <a href="https://www.linkedin.com/in/reissr" target="_blank">Linkedin</a>

---

## License

[![License](http://img.shields.io/:license-mit-blue.svg?style=flat-square)](http://badges.mit-license.org)